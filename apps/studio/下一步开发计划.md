# @sker/studio 下一步开发计划

基于当前项目完成状态 (2025-09-29) 制定的精确开发路线图

## 📊 项目状态全面评估

### ✅ 已完成模块 (架构层面 90%)
- **完整项目架构**: 按设计文档实现完整的目录结构和组件体系
- **React Flow画布引擎**: 集成完成，支持无限滚动和节点操作
- **AI服务层**: 完整AIService类，支持内容生成、优化、融合等核心功能
- **WebSocket通信**: 实时通信服务，断线重连和消息队列机制
- **状态管理体系**: Zustand stores完整架构 (canvas/node/ai/ui)
- **TypeScript类型系统**: 完整类型定义，确保开发期类型安全
- **构建部署流程**: 项目可正常构建，生产环境ready (13.30s构建)

### 🔄 开发中模块 (交互层面 65%)
- **双击创建框架**: Canvas组件已支持事件监听，具体AI调用逻辑待实现
- **拖拽扩展基础**: React Flow连线功能存在，扩展逻辑待完善
- **UI组件框架**: Button、Modal、Toast等组件结构已创建，具体实现待完善
- **右键菜单**: ContextMenu组件框架已建立，菜单项和交互逻辑待实现

### ⏳ 待开发模块 (体验层面 40%)
- **节点编辑器**: 内容编辑界面和AI优化功能完全待实现
- **版本管理UI**: 历史记录可视化界面待设计和实现
- **搜索筛选系统**: 多维度搜索和筛选机制待开发
- **错误处理机制**: 用户友好的错误反馈系统待建立

### 🎯 关键瓶颈识别
1. **交互逻辑断层**: AI服务与UI交互之间缺少连接桥梁
2. **组件实现不足**: 基础UI组件只有结构，缺少具体实现
3. **用户流程不通**: 从用户操作到AI响应的完整流程未打通
4. **状态同步问题**: Store状态变化与UI更新的同步机制需完善

## 🎯 Phase 1: 核心交互完善 (优先级最高，1-2周)

### 1.1 双击创建功能
**目标**: 用户在空白画布双击时创建AI节点

**技术实现**:
```typescript
// Canvas.tsx 中添加双击事件
const handleCanvasDoubleClick = useCallback((event: MouseEvent) => {
  const rect = canvasRef.current?.getBoundingClientRect()
  const position = {
    x: event.clientX - rect.left,
    y: event.clientY - rect.top
  }
  
  // 调用AI服务生成内容
  const newNode = await aiService.generateContent({
    inputs: [],
    type: 'initial',
    instruction: '开始新的思维创作'
  })
  
  // 添加到节点store
  nodeStore.addNode({
    id: generateId(),
    position,
    content: newNode.content,
    title: newNode.title
  })
}, [])
```

**验收标准**:
- [ ] 双击空白区域创建新节点
- [ ] 节点显示AI生成的内容
- [ ] 支持多次创建不重叠

### 1.2 拖拽连线扩展
**目标**: 从现有节点拖拽连线到空白处创建新节点

**技术实现**:
```typescript
// React Flow onConnectEnd 事件处理
const handleConnectEnd = useCallback((event, connectionState) => {
  if (!connectionState.isValid) {
    // 连线到空白处，创建新节点
    const sourceNode = nodes.find(n => n.id === connectionState.fromNode.id)
    const newNode = await aiService.generateContent({
      inputs: [sourceNode.content],
      type: 'expansion',
      instruction: '基于以上内容进行思维扩展'
    })
    
    // 创建新节点并建立连接
    const nodeId = generateId()
    nodeStore.addNode({ /* 新节点数据 */ })
    nodeStore.connectNodes(connectionState.fromNode.id, nodeId)
  }
}, [nodes])
```

**验收标准**:
- [ ] 可以从节点拖拽连线到空白处
- [ ] 自动创建相关内容的新节点
- [ ] 建立正确的连接关系

### 1.3 右键菜单系统
**目标**: 画布和节点的上下文操作菜单

**功能列表**:
- 画布右键: 创建空节点、粘贴、画布设置
- 节点右键: 编辑、优化、复制、删除、版本历史
- 连线右键: 删除连接、编辑关系

**验收标准**:
- [ ] 右键菜单正确显示
- [ ] 所有操作功能正常
- [ ] 菜单样式符合设计规范

### 1.4 节点内容编辑器
**目标**: 可以编辑节点内容并保存版本

**技术实现**:
- 支持 Markdown 编辑
- 自动保存草稿
- 版本历史记录

**验收标准**:
- [ ] 双击节点进入编辑模式
- [ ] 支持 Markdown 语法
- [ ] 自动保存和版本管理

## 🤖 Phase 2: AI协作增强 (2-3周)

### 2.1 多输入融合功能
**目标**: 空节点可以接收多个输入，AI融合生成内容

**技术实现**:
```typescript
// 空节点检测多个输入连接
const handleMultipleInputs = useCallback(async (nodeId: string) => {
  const inputNodes = getConnectedInputs(nodeId)
  if (inputNodes.length >= 2) {
    const inputs = inputNodes.map(node => node.content)
    const fusedContent = await aiService.fusionGenerate(inputs, 'synthesis')
    nodeStore.updateNode(nodeId, { content: fusedContent.content })
  }
}, [])
```

### 2.2 智能标题生成
**目标**: AI自动为节点生成简洁标题

### 2.3 置信度可视化
**目标**: 显示AI生成内容的可信度评分

### 2.4 实时状态反馈
**目标**: 显示节点的处理状态（处理中、已完成、错误）

## 🎨 Phase 3: 用户体验优化 (1-2周)

### 3.1 搜索和筛选
**目标**: 按内容、标签、重要性筛选节点

### 3.2 快捷键支持
**目标**: 提升操作效率的键盘快捷键

**快捷键列表**:
- `Ctrl+N`: 创建新节点
- `Delete`: 删除选中节点
- `Ctrl+D`: 复制节点
- `Tab`: 切换显示模式
- `Ctrl+F`: 搜索节点

### 3.3 错误处理完善
**目标**: 优雅的错误提示和恢复机制

### 3.4 性能优化
**目标**: 大规模节点的流畅渲染

## 📅 实施时间表

### Week 1: 核心交互 (第一优先级)
- **Day 1-2**: 双击创建功能
- **Day 3-4**: 拖拽连线扩展
- **Day 5-7**: 右键菜单系统

### Week 2: 交互完善
- **Day 1-3**: 节点编辑器
- **Day 4-5**: 基础UI组件完善
- **Day 6-7**: 错误处理和测试

### Week 3-4: AI协作增强
- **Week 3**: 多输入融合、智能标题
- **Week 4**: 置信度显示、状态反馈

### Week 5: 用户体验
- **前半周**: 搜索筛选、快捷键
- **后半周**: 性能优化、整体测试

## 🔧 技术风险和解决方案

### 风险1: React Flow 性能问题
**解决方案**: 使用虚拟化渲染，节点懒加载

### 风险2: AI服务响应延迟
**解决方案**: 增加加载状态，优化WebSocket连接

### 风险3: 状态管理复杂性
**解决方案**: 保持store职责单一，添加中间件日志

## 🎯 成功指标

### 功能指标
- [ ] 用户可以在5分钟内完成首次思维图创建
- [ ] AI生成响应时间 < 3秒
- [ ] 支持同时处理100+节点而不卡顿

### 体验指标  
- [ ] 用户操作流畅，无明显延迟
- [ ] 错误恢复机制友好
- [ ] 界面简洁直观，符合MVP设计

## 📋 开发检查清单

### 开发前准备
- [ ] 确认AI服务API可用
- [ ] 配置WebSocket连接
- [ ] 设置开发环境变量

### 每个功能开发完成后
- [ ] 单元测试通过
- [ ] TypeScript类型检查无错误
- [ ] ESLint检查通过
- [ ] 手动功能测试通过
- [ ] 更新相关文档

### 阶段性检查
- [ ] 所有核心用户流程可用
- [ ] 性能指标达标
- [ ] 错误处理覆盖完整
- [ ] 代码质量符合标准

这个开发计划专注于快速实现MVP的核心价值，确保用户可以体验到完整的AI协作画布工作流程。