# @sker/studio 功能菜单设计

**核心任务**：设计 @sker/studio - 主画布Web应用，核心的AI协作画布应用，提供完整的思维整理和扩展功能。

**技术栈**：
- React 18 + TypeScript
- TailwindCSS
- API状态管理：TanStack Query
- 页面状态管理：Zustand
- 画布引擎：React Flow

## 功能菜单列表

### 🎨 **画布控制**
- **无限画布** - 支持无限滚动的工作区域，让思维无边界扩展
- **缩放控制** - 10%-500%缩放范围，适应不同层次的内容展示
- **显示模式** - 概览/预览/详细三种模式，平衡结构感知与内容深度
- **画布导航** - 缩略图和快速定位，大型思维网络便捷导航

**开发原因**：核心交互基础，决定用户思维流动的体验质量

### 🧠 **智能组件**
- **双击创世** - 空白画布双击创建第一个AI组件，"从无到有"的创造起点
- **拖拽扩展** - 连线到空白处自动生成新组件，实现"一生二"的思维扩展
- **多输入融合** - 空组件接收多个输入，AI融合生成综合内容，实现"二生三"
- **智能标题** - AI自动生成组件标题，提升内容识别效率
- **重要性标识** - 1-5星等级系统，构建信息层次和视觉权重

**开发原因**：实现AI协作的核心机制，让AI成为主动的思维伙伴

### 📊 **信息管理**
- **语义标签** - 自动识别内容类型（需求分析、技术方案、项目计划等）
- **置信度显示** - AI生成内容的可信度评分，帮助用户判断内容质量
- **用户评分** - 人工反馈系统，持续优化AI生成质量
- **搜索筛选** - 按标题、内容、类型、重要性多维度筛选
- **专注模式** - 高亮相关组件，减少干扰信息

**开发原因**：解决大规模思维网络的信息过载问题

### 🔄 **版本管理**
- **双击优化** - 组件内容AI重新生成，支持持续迭代改进
- **变更记录** - 记录每次修改的原因和类型（实验性/确定性/细节完善）
- **版本历史** - 完整的变更轨迹，支持任意版本回滚
- **差异对比** - 可视化显示版本间的内容变化
- **安全回滚** - 保护重要内容，避免意外丢失

**开发原因**：符合人类思维习惯的认知友好版本控制

### 💫 **AI协作**
- **智能内容生成** - 基于上下文的高质量内容创作
- **多输入理解** - 处理复杂关系，生成融合性内容
- **语义理解** - 理解内容含义，自动分类和管理
- **实时处理** - WebSocket + RabbitMQ确保响应体验
- **错误恢复** - 处理失败时的重试和回退机制

**开发原因**：将AI从被动工具转变为主动的思维协作伙伴

### 🎯 **状态管理**
- **组件状态** - 待运行/运行中/已完成/错误等状态可视化
- **画布状态** - 保存视图位置、筛选设置等工作环境
- **项目管理** - 多项目切换和数据隔离
- **实时同步** - 状态变化的即时反馈和持久化

**开发原因**：确保用户工作流的连续性和可预测性

### 📈 **数据洞察**
- **画布统计** - 组件数量、重要性分布、平均置信度等指标
- **使用分析** - 了解思维模式和优化建议
- **AI性能** - 生成质量和响应时间监控
- **协作效率** - 思维整理和决策分析的效率提升度量

**开发原因**：帮助用户了解思维模式，持续优化工作方法

### ⚙️ **系统设置**
- **AI配置** - 模型选择、参数调整、API配置
- **界面定制** - 主题、布局、快捷键等个性化设置
- **数据导出** - 支持多种格式的内容导出和备份
- **权限管理** - 项目访问控制和协作权限设置

**开发原因**：提供灵活的个性化配置，适应不同用户需求

### 🚀 **性能优化**
- **虚拟化渲染** - React Flow内置虚拟化，支持大量组件
- **增量更新** - 只渲染变化的组件，减少性能开销
- **缓存机制** - Redis缓存AI结果和画布状态
- **后台处理** - 异步AI处理，不阻塞用户交互

**开发原因**：确保大规模思维网络下的流畅体验

## 核心价值

这套功能菜单设计围绕"从无到有的AI协作创造"理念，通过现代化技术栈实现：

1. **智能语义化** - 理解内容含义，自动分类管理
2. **高性能画布** - 支持大规模复杂思维网络  
3. **认知友好** - 版本管理符合人类思维习惯
4. **实时AI协作** - 从被动工具到主动伙伴
5. **无限扩展性** - 从简单想法到复杂方案

每个功能都直接服务于提升用户的思维协作效率和AI协作体验，构建真正适合大规模思维协作的智能平台。

## 侧边栏导航菜单设计 (MVP极简版)

> ⚠️ **过度设计检查**：基于MVP"极简创造体验"原则，大幅简化侧边栏功能

### 🎯 **MVP核心原则**
- **极简交互**：用户只需双击+连线+输入，其他都是次要
- **渐进披露**：先满足核心创造流程，高级功能后续迭代
- **认知负载最小**：避免复杂的多层级导航和设置

### 📱 **MVP侧边栏设计** (简化80%)

```
┌─────────────────┐
│ 🌟 SKER        │ ← 品牌标识
├─────────────────┤
│ 👁️ 预览模式     │ ← 仅保留预览模式(MVP)
│ 🔍 50%         │ ← 缩放指示器
├─────────────────┤
│ 🔍 搜索组件     │ ← 简单搜索框
├─────────────────┤
│ 📊 画布状态     │ ← 组件数量统计
│   3个组件       │
│   平均⭐⭐⭐     │
└─────────────────┘
```

**MVP阶段移除的功能**：
- ❌ 多显示模式切换 (概览/详细) → 只保留预览模式
- ❌ 复杂的智能工具区 → 功能集成到右键菜单
- ❌ 项目管理 → 单项目MVP版本
- ❌ 版本历史面板 → 简化为组件内版本标识
- ❌ 数据洞察 → 只保留基础统计
- ❌ 设置面板 → 最小化配置

### 🚀 **极简交互逻辑**

**Step 1: 专注画布交互** ✅ 基础架构完成
```
用户操作流程:
1. 双击空白处 → 创建第一个组件 ✨ (待实现)
2. 拖拽连线到空白处 → 创建扩展组件 🔗 (待实现) 
3. 右键空白处 → 创建空组件 ⭕ (待实现)
4. 双击组件 → 优化内容 🔄 (待实现)

侧边栏作用: 最小化干扰，仅提供必要的导航支持 ✅ 组件已创建
```

**Step 2: 渐进功能集成**
```
右键菜单集成功能 (而非侧边栏):
• 右键画布 → 创建空组件 / 粘贴组件 / 画布设置
• 右键组件 → 编辑 / 优化 / 复制 / 删除 / 版本历史
• 拖拽连线 → 智能连线推荐
• 顶部工具栏 → 保存 / 导出 / 全屏 / 帮助
```

### 📋 **MVP功能分配重构**

#### 🔄 **移动到右键菜单**
- 智能连线推荐 → 拖拽连线时自动提示
- 批量操作 → 右键菜单批量选择
- 版本历史 → 右键组件查看历史
- 导出功能 → 顶部工具栏

#### 📍 **集成到画布交互**
- 显示模式切换 → 快捷键 (Tab键)
- 缩放控制 → 鼠标滚轮 + 快捷键
- 组件筛选 → 搜索框实时筛选
- 全屏模式 → F11 或顶部按钮

#### ⚙️ **简化到最小配置**
- AI配置 → 仅保留模型选择(顶部下拉)
- 主题切换 → 系统跟随或单一深色主题
- 快捷键 → 固定快捷键，不可自定义

### 🎨 **MVP视觉设计**

```scss
// 极简侧边栏样式
.mvp-sidebar {
  width: 200px;           // 减少宽度
  background: #1a1b23;    
  border-right: 1px solid #343640;
  padding: 1rem 0.5rem;   // 减少内边距
  
  // 只保留3个核心区域
  .brand { /* 品牌区 */ }
  .quick-controls { /* 快速控制 */ }
  .canvas-stats { /* 画布统计 */ }
}

// 移除复杂的多区域样式
// ❌ .sidebar-section (7个区域)
// ❌ .advanced-filters
// ❌ .version-timeline  
// ❌ .analytics-charts
```

### ⚡ **MVP实现优先级** (更新状态)

**Week 1-2: 核心画布功能** 🔄 进行中
- ⏳ 双击创建组件 (交互逻辑待实现)
- ⏳ 连线扩展组件 (交互逻辑待实现)
- ⏳ 右键创建空组件 (右键菜单待实现)
- ✅ 基础搜索功能 (SearchBox组件已创建)

**Week 3: 必要辅助功能** ⏳ 待开始
- ⏳ 简单的版本管理(组件内版本号)
- ✅ 基础统计显示 (CanvasStats组件已创建)
- ✅ 简单的缩放指示器 (ZoomIndicator组件已创建)

**Week 4: 体验优化** ⏳ 待开始
- ⏳ 右键菜单完善
- ⏳ 快捷键支持
- ⏳ 错误处理

### 💡 **V2.0迭代规划** (MVP后)

```yaml
MVP验证成功后逐步添加:
  Phase 1 (1个月后):
    - 多显示模式切换
    - 项目管理功能
    - 高级搜索筛选
    
  Phase 2 (3个月后):  
    - 完整版本历史面板
    - 数据洞察和分析
    - 智能工具集成
    
  Phase 3 (6个月后):
    - 协作功能
    - 个性化设置
    - 高级AI功能
```

### 🎯 **MVP验收标准调整**

```yaml
核心功能(必须):
  - ✅ 双击创建组件流程完整
  - ✅ 连线扩展功能正常
  - ✅ 基础搜索和导航
  - ✅ 简单的状态统计

体验功能(重要):
  - ✅ 流畅的画布交互
  - ✅ 右键菜单便捷操作
  - ✅ 快捷键支持

高级功能(可延迟):
  - ⏸️ 复杂的信息管理
  - ⏸️ 高级数据分析
  - ⏸️ 详细配置选项
```

## MVP设计哲学

**"少即是多"** - 通过减少UI复杂度，让用户专注于核心的AI协作创造过程。侧边栏从"功能展示中心"回归到"辅助导航工具"，支持而不干扰用户的思维流动。

## MVP技术实现要点

### 🔧 **MVP状态管理** (简化版)
```typescript
// MVP版本的Zustand状态管理
interface MVPCanvasState {
  // 核心状态 (MVP必需)
  searchQuery: string;
  zoomLevel: number;
  componentCount: number;
  averageRating: number;
  
  // MVP版本移除的复杂状态
  // ❌ activeSection: 不需要多区域切换
  // ❌ displayMode: 固定预览模式
  // ❌ filterSettings: 简化为搜索
  // ❌ selectedComponent: 简化交互
  
  // 简化的Actions
  updateSearch: (query: string) => void;
  updateZoom: (level: number) => void;
  updateStats: (count: number, rating: number) => void;
}
```

### 📱 **MVP响应式布局**
```css
/* MVP简化响应式 */
.mvp-sidebar {
  width: 200px;        /* 固定宽度，减少复杂性 */
  position: fixed;
  left: 0;
  top: 0;
  height: 100vh;
  background: #1a1b23;
  border-right: 1px solid #343640;
  z-index: 100;
  
  /* 移动端简化处理 */
  @media (max-width: 768px) {
    width: 180px;      /* 不做复杂的隐藏/显示 */
  }
}

/* 移除复杂的展开/收起动画 */
/* ❌ transform animations */
/* ❌ multiple breakpoints */
/* ❌ dynamic width changes */
```

### ⚡ **MVP开发重点**

**专注核心交互**：
1. 双击画布创建组件
2. 拖拽连线扩展思维
3. 右键菜单操作
4. 简单搜索定位

**暂缓复杂功能**：
- 多显示模式切换
- 高级筛选和排序  
- 复杂的版本管理界面
- 数据可视化图表
- 个性化配置选项

### 🎯 **4周开发计划调整** (实际进度)

**Week 1**: 画布 + 基础侧边栏 ✅ 已完成
- ✅ React Flow画布搭建
- ✅ MVP侧边栏(搜索+统计)
- ✅ 基础组件系统

**Week 2**: AI协作核心 ✅ 服务层完成
- ✅ AI服务架构完成
- ✅ WebSocket通信服务
- ⏳ 双击创建组件 (交互逻辑待实现)
- ⏳ 连线扩展功能 (交互逻辑待实现)

**Week 3**: 交互完善 🔄 当前阶段
- ⏳ 右键菜单系统 (待实现)
- ⏳ 基础版本管理 (待实现)
- ✅ 搜索功能组件完善

**Week 4**: 测试优化 ⏳ 下一阶段
- ⏳ 用户体验优化
- ⏳ 性能调优
- ⏳ 错误处理

### 📋 **当前开发状态总结**
- ✅ **架构设计**: 完整的组件体系和服务层架构
- ✅ **基础设施**: React Flow画布、Zustand状态管理、TypeScript类型系统
- ✅ **AI服务**: 完整的AI内容生成、优化、融合功能
- ✅ **通信层**: WebSocket实时通信和断线重连机制
- 🔄 **交互层**: 核心用户交互逻辑正在开发中
- ⏳ **UI组件**: 基础UI组件需要具体实现
- ⏳ **错误处理**: 完整的错误边界和用户反馈机制

这个MVP版本侧边栏将专注于支持核心的AI协作创造流程，避免过度设计带来的开发复杂度和用户认知负担。